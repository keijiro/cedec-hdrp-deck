<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />
  <title>big</title>
  <link href='big.css' rel='stylesheet' type='text/css' />
  <link href='highlight.css' rel='stylesheet' type='text/css' />
  <style>
    .new-shiny { background: #aaaaaa; }
  </style>
  <script src='big.js'></script>
  <script src='highlight.js'></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body class='dark'>
  <div><p>HDRP</p>
</div>
<div><p>High<br/>Definition<br/>Render<br/>Pipeline</p>
<p><notes>Unity が公式に開発配布する SRP のひとつ
最新の機能を詰め込んだ新しいレンダーパイプライン
もっと分かりやすく有り体に言ってしまえば……</notes></p>
</div>
<div><p>PS4 を<br/>ベースラインにした<br/>新しいレンダラー</p>
<p><notes>PS4 の AAA タイトルなどでよく使われているレンダリング方式をベースに</notes></p>
</div>
<div><img src="img/Features.png"/>

<p><notes>ここが便利だな、ここがおいしいな、と思ったポイントをアトランダムに紹介</notes></p>
</div>
<div><p><a href="https://github.com/keijiro/TestbedHDRP">github.com/keijiro/TestbedHDRP</a></p>
</div>
<div><br/>

</div>
<div><p>メリットその１<br/>ライティングが<br/>むちゃくちゃ強力</p>
<p><notes>ライティングについて、様々な便利な機能が追加されているうえ、同時に高速化もなされているため、負荷を適度に抑えつつも、凝ったライティングを構築することが可能に</notes></p>
</div>
<div><p>FPTL</p>
<p><notes>その高速化のカギとなるのが FPTL</notes></p>
</div>
<div><p>Fine<br/>Pruned<br/>Tiled<br/>Lighting</p>
<p><notes>Deferred Shading を高速化する仕組み
いわゆるタイルベースレンダリングの一種
例えばこんなシーンがあるとする</notes></p>
</div>
<div><img src="img/FPTL1.png"/>

<p><notes>Deferred Shading ではこれをまず GBuffer にレンダリングする</notes></p>
</div>
<div><img src="img/GBuffer.png"/>

<p><notes>これを細かなタイルに分割して</notes></p>
</div>
<div><img src="img/FPTL2.png"/>

<p><notes>２段階に分けて厳密に絞り込むので fine pruned
GBuffer へのアクセスが最小限で済むのでメモリ帯域に優しい</notes></p>
<p><notes>難しい理屈はあるが……簡単に言えば……
タイルデバッグモードで表示されるこの数値を低くすれば軽くなる
Directional Light は例外</notes></p>
</div>
<div><img src="img/FPTL3.png"/>

<p><notes>極端な例
20 x 10 = 200 個のスポットライト</notes></p>
</div>
<div><img src="img/FPTL4.png"/>

</div>
<div><img src="img/GPUPro7.png"/>

</div>
<div><p>半透明<br/>
Clustered Forward Shading</p>
</div>
<div><p><notes>FPTL は主にパフォーマンスに関係
他にもパワーアップのポイントはある</notes></p>
</div>
<div><p>新しいライト形状<br/>矩形ライト<br/>線分ライト</p>
</div>
<div><img src="img/LightType.png"/>

<p><notes>テレビ画面のような面積を持った光源
レフ板やディフューザーを使ったような柔らかなライティング</notes></p>
</div>
<div><img src="img/LTC.png"/>

<p><notes>Sphere や Disc も追加予定</notes></p>
</div>
<div><img style="width:100%;height:1px" src="img/Blank.png"/>

<img style="width:49%" src="img/LightFx1.gif"/>
<img style="width:49%" src="img/LightFx2.gif"/>

<img style="width:100%;height:1px" src="img/Blank.png"/>

<p><notes>スタティックなエリアライトと違って動きのある表現にも使えるのが面白い</notes></p>
</div>
<div><p>すごく便利<br/>弱点：<br/>明るくなり過ぎがち</p>
<p><notes>シャドウが使えないので</notes></p>
</div>
<div><img src="img/SSAO.png"/>

<p><notes>PPS の Volume と組み合わせるといいかも</notes></p>
</div>
<div><br/>

</div>
<div><img src="img/LightValue.png"/>

<p><notes>色温度での色の設定も可能</notes></p>
</div>
<div><p>Volumetric Lighting</p>
<p>(Volumetric Fog)</p>
</div>
<div><img src="img/VolumetricLight.png"/>

</div>
<div><p><notes>ライティングについては以上</notes></p>
</div>
<div><p>メリットその２<br/>標準シェーダーがむちゃくちゃ強力</p>
<p><notes>標準の PBR シェーダーが強化されている</notes></p>
</div>
<div><img src="img/Lit1.png"/>

<p><notes>ぱっと見では若干パラメーターが増えているかなあ、という程度だが……</notes></p>
</div>
<div><img src="img/Lit2.png"/>

</div>
<div><img src="img/Lit3.png"/>

</div>
<div><img src="img/Lit4.png"/>

</div>
<div><img src="img/Lit5.png"/>

</div>
<div><img src="img/Lit6.png"/>

</div>
<div><p>Subsurface Scattering<br/>表面下散乱</p>
</div>
<div><img src="img/SSS1.png"/>

</div>
<div><img src="img/SSS2.png"/>

</div>
<div><img src="img/SSS3.png"/>

</div>
<div><p>Thickness map<br/>xNormal<br/>Knald<br/>Substance Painter</p>
</div>
<div><img src="img/SSS4.png"/>

<p><notes>マテリアルとは別に Diffusion Profile というのを用意する
１パイプラインにつき１６個まで定義できる</notes></p>
</div>
<div><p>Anisotropy<br/>異方性反射</p>
</div>
<div><img src="img/Anisotropy1.png"/>

</div>
<div><img src="img/Anisotropy2.png"/>

</div>
<div><img src="img/Anisotropy3.png"/>

</div>
<div><p>Iridescence<br/>虹色反射</p>
</div>
<div><img src="img/Iridescence.png"/>

</div>
<div><p>Bent Normal Mapping</p>
</div>
<div><img src="img/BentNormal1.png"/>

</div>
<div><img src="img/BentNormal2.png"/>

<p><notes>Specular Occlusion</notes></p>
</div>
<div><p>Displacement Mapping</p>
</div>
<div><img src="img/Displacement1.png"/>

</div>
<div><img src="img/Displacement2.png"/>

<p><notes>Pixel displacement
Tesselation displacement</notes></p>
</div>
<div><img src="img/Displacement3.png"/>

</div>
<div><img src="img/Displacement4.png"/>

<p><notes>Pixel displacement は凹み方向のみ
平面への適用のみ正しく処理できる</notes></p>
</div>
<div><p>Layered Material<br/>
レイヤー機能</p>
</div>
<div><img src="img/Layered2.png"/>

</div>
<div><img src="img/Layered3.png"/>

</div>
<div><img src="img/Layered1.png"/>

<p><notes>マスクにはテクスチャと頂点カラーが使える
レイヤーとデカールを使いこなすのがディテール感を出すコツ</notes></p>
</div>
<div><p>メリットその３<br/>カスタマイズに<br/>フレンドリー</p>
<p><notes>カスタマイズされることを想定した設計になっている
まず何といっても違うのは……</notes></p>
</div>
<div><p>ソースコードが<br/><a href="https://github.com/Unity-Technologies/ScriptableRenderPipeline">GitHub</a> 上に<br/>公開されている</p>
</div>
<div><p>パッケージとして<br/>独立した<br/>バージョニング</p>
</div>
<div><img src="img/Versioning1.png"/>

</div>
<div><img src="img/Versioning2.png"/>

</div>
<div><img src="img/Versioning3.png"/>

</div>
<div><img src="img/Versioning4.png"/>

</div>
<div><p><notes>中の実装についてもカスタマイズが許容されるものになっている
というのも……</notes></p>
</div>
<div><p>今までのUnity<br/>謎マクロ<br/>謎プラグマが暗躍</p>
</div>
<div><pre>#pragma surface surf Standard vertex:vert addshadow

void vert(inout appdata_full v, out Input data)
{
  UNITY_INITIALIZE_OUTPUT(Input, data);
  ...
}

void surf(Input IN, inout SurfaceOutputStandard o)
{
  ...
}</pre>

</div>
<div><p>関数、structを使った<br/>C言語風の実装<br/>汎用的な<br/>シェーダーライブラリ<br/></p>
</div>
<div><img style="width:100%;height:1px" src="img/Blank.png"/>

<img style="width:49%" src="img/CustomShader1.gif"/>
<img style="width:49%" src="img/CustomShader2.gif"/>

<img style="width:49%" src="img/CustomShader3.gif"/>
<img style="width:49%" src="img/CustomShader4.gif"/>

<img style="width:100%;height:1px" src="img/Blank.png"/>

</div>
<div><p>カスタムシェーダー<br/><a href="https://github.com/Unity-Technologies/ScriptableRenderPipeline/blob/master/com.unity.render-pipelines.high-definition/HDRP/Material/Lit/Lit.shader">Lit.shader</a> をコピペして改造</p>
</div>
<div><p>頂点いじるなら <a href="https://github.com/Unity-Technologies/ScriptableRenderPipeline/blob/master/com.unity.render-pipelines.high-definition/HDRP/ShaderPass/VertMesh.hlsl">VertMesh.hlsl</a> の辺りを改造</p>
</div>
<div><p>GBuffer いじるなら <a href="https://github.com/Unity-Technologies/ScriptableRenderPipeline/blob/master/com.unity.render-pipelines.high-definition/HDRP/ShaderPass/ShaderPassGBuffer.hlsl">ShaderPassGBuffer.hlsl</a> の辺りを改造</p>
</div>
<div><p>#define と<br/>#include の塊</p>
</div>
<div><p>ホワイトボックス<br/>なので諦める<br/>ポイントは少ない</p>
</div>
<div><br/>

</div>
<div><p>HDRP<br/>導入検討の<br/>ポイント</p>
<p><notes>導入すべきか、せざるべきか
判断ポイント</notes></p>
</div>
<div><p>で、もう<br/>完成してるの？<br/>使っていいの？</p>
</div>
<div><ul>
<li>未実装部分が少なくない</li>
<li>後方互換性が確立されていない</li>
</ul>
</div>
<div><ul>
<li>長期プロジェクトへの導入は慎重に</li>
<li>ワンオフ的に使うならアリです</li>
</ul>
<p><notes>後方互換性がしっかりしていないのけど、未実装部分があるので、長期間使っていくのはつらい
とは言え、いきなりクラッシュするような不安定さは無いので、短期間の用途で使うなら</notes></p>
</div>
<div><p>謝辞</p>
<ul>
<li>Statue models scanned by Geoffrey Marchal (CC-BY)
<a href="https://sketchfab.com/geoffreymarchal">https://sketchfab.com/geoffreymarchal</a></li>
<li>Photogrammetric textures created by StruffelProductions (CC0)
<a href="https://cc0textures.com">https://cc0textures.com</a></li>
</ul>
</div>
</body>
</html>
