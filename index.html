<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />
  <title>big</title>
  <link href='big.css' rel='stylesheet' type='text/css' />
  <link href='highlight.css' rel='stylesheet' type='text/css' />
  <style>
    .new-shiny { background: #aaaaaa; }
  </style>
  <script src='big.js'></script>
  <script src='highlight.js'></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body class='dark'>
  <div><p>HDRP</p>
</div>
<div><p>High<br/>Definition<br/>Render<br/>Pipeline</p>
<p><notes>Unity が公式に開発配布する SRP のひとつ
最新の機能を詰め込んだ新しいレンダーパイプライン
もっと分かりやすく有り体に言ってしまえば……</notes></p>
</div>
<div><p>PS4 を<br/>ベースラインにした<br/>新しいレンダラー</p>
<p><notes>PS4 の AAA タイトルなどでよく使われているレンダリング方式をベースに
PS4 および PS4 以降のハードウェアのスペックに合わせて設計されたレンダラー</notes></p>
</div>
<div><img src="img/Features.png"/>

<p><notes>ここが便利だな、ここがおいしいな、と思ったポイントをアトランダムに紹介</notes></p>
</div>
<div><ul>
<li><p>サンプルプロジェクト</p>
<p><a href="https://github.com/keijiro/TestbedHDRP">https://github.com/keijiro/TestbedHDRP</a></p>
</li>
<li><p>プレゼン資料</p>
<p><a href="https://keijiro.github.io/cedec-hdrp-deck">https://keijiro.github.io/cedec-hdrp-deck</a></p>
</li>
</ul>
</div>
<div><br/>

</div>
<div><p>メリットその１<br/>ライティングが<br/>むちゃくちゃ強力</p>
<p><notes>ライティングについて、様々な便利な機能が追加されているうえ、同時に高速化もなされているため、負荷を適度に抑えつつも、凝ったライティングを構築することが可能に</notes></p>
</div>
<div><p>FPTL</p>
<p><notes>その高速化のカギとなるのが FPTL</notes></p>
</div>
<div><p>Fine<br/>Pruned<br/>Tiled<br/>Lighting</p>
<p><notes>Deferred Shading を高速化する仕組み
いわゆるタイルベースレンダリングの一種
例えばこんなシーンがあるとする</notes></p>
</div>
<div><img src="img/FPTL1.png"/>

</div>
<div><img src="img/GBuffer.png"/>

</div>
<div><img src="img/FPTL2.png"/>

<p><notes>Directional Light は例外</notes></p>
</div>
<div><img src="img/FPTL3.png"/>

<p><notes>20 x 10 = 200 個のスポットライト</notes></p>
</div>
<div><img src="img/FPTL4.png"/>

</div>
<div><img src="img/GPUPro7.png"/>

</div>
<div><p>半透明<br/>
Clustered Forward Shading</p>
</div>
<div><p><notes>FPTL は主にパフォーマンスに関係
他にもパワーアップのポイントはある</notes></p>
</div>
<div><p>新しいライト形状<br/>矩形ライト<br/>線分ライト</p>
</div>
<div><img src="img/LightType.png"/>

<p><notes>テレビ画面のような面積を持った光源
レフ板やディフューザーを使ったような柔らかなライティング</notes></p>
</div>
<div><img src="img/LTC.png"/>

<p><notes>Sphere や Disc も追加予定</notes></p>
</div>
<div><img style="width:100%;height:1px" src="img/Blank.png"/>

<img style="width:49%" src="img/LightFx1.gif"/>
<img style="width:49%" src="img/LightFx2.gif"/>

<img style="width:100%;height:1px" src="img/Blank.png"/>

</div>
<div><p>すごく便利<br/>弱点：<br/>明るくなり過ぎがち</p>
<p><notes>シャドウが使えないので</notes></p>
</div>
<div><img src="img/SSAO.png"/>

</div>
<div><br/>

</div>
<div><img src="img/LightValue.png"/>

<p><notes>色温度</notes></p>
</div>
<div><p>Volumetric Lighting</p>
<p>(Volumetric Fog)</p>
</div>
<div><img src="img/VolumetricLight.png"/>

</div>
<div><p><notes>ライティングについては以上</notes></p>
</div>
<div><p>メリットその２<br/>標準シェーダーがむちゃくちゃ強力</p>
<p><notes>標準の PBR シェーダーが強化されている</notes></p>
</div>
<div><img src="img/Lit1.png"/>

<p><notes>ぱっと見では若干パラメーターが増えているかなあ、という程度だが……</notes></p>
</div>
<div><img src="img/Lit2.png"/>

</div>
<div><img src="img/Lit3.png"/>

</div>
<div><img src="img/Lit4.png"/>

</div>
<div><img src="img/Lit5.png"/>

</div>
<div><img src="img/Lit6.png"/>

</div>
<div><p>Subsurface Scattering<br/>表面下散乱</p>
</div>
<div><img src="img/SSS1.png"/>

<p><notes>人の肌、ゼリー、ミルク、大理石</notes></p>
</div>
<div><img src="img/SSS2.png"/>

<p><notes>エリアライトとの組み合わせが面白い</notes></p>
</div>
<div><img src="img/SSS3.png"/>

<p><notes>Thickness map
Substance Painter
xNormal, Knald</notes></p>
</div>
<div><img src="img/SSS4.png"/>

<p><notes>マテリアルとは別に Diffusion Profile を用意する
１パイプラインにつき１６個まで定義できる</notes></p>
</div>
<div><p>Anisotropy<br/>異方性反射</p>
</div>
<div><img src="img/Anisotropy1.png"/>

</div>
<div><img src="img/Anisotropy2.png"/>

<p><notes>Tangent</notes></p>
</div>
<div><img src="img/Anisotropy3.png"/>

<p><notes>Binormal</notes></p>
</div>
<div><p>Iridescence<br/>虹色反射</p>
</div>
<div><img src="img/Iridescence.png"/>

<p><notes>シャボン玉、虫の羽</notes></p>
</div>
<div><p>Bent Normal Mapping</p>
</div>
<div><img src="img/BentNormal1.png"/>

</div>
<div><img src="img/BentNormal2.png"/>

<p><notes>Specular Occlusion</notes></p>
</div>
<div><p>Displacement Mapping</p>
</div>
<div><img src="img/Displacement1.png"/>

</div>
<div><img src="img/Displacement2.png"/>

<p><notes>Pixel displacement (parallax occlusion mapping)
Vertex/Tesselation displacement</notes></p>
</div>
<div><img src="img/Displacement3.png"/>

<p><notes>Pixel displacement は凹み方向のみ
平面への適用のみ正しく処理できる</notes></p>
</div>
<div><p><notes>このようにマテリアルの基本的な表現力が向上しているが
それを組み合わせて更に複雑にするための機能が用意されている</notes></p>
</div>
<div><p>Layered Material<br/>
レイヤー機能</p>
</div>
<div><img src="img/Layered2.png"/>

</div>
<div><img src="img/Layered3.png"/>

</div>
<div><img src="img/Layered1.png"/>

<p><notes>マスクにはテクスチャと頂点カラーが使える
レイヤーとデカールを使いこなすのがディテール感を出すコツ</notes></p>
</div>
<div><br/>

</div>
<div><p>メリットその３<br/>カスタマイズに<br/>フレンドリー</p>
<p><notes>カスタマイズされることを想定した設計になっている
まず何といっても違うのは……</notes></p>
</div>
<div><p>ソースコードが<br/><a href="https://github.com/Unity-Technologies/ScriptableRenderPipeline">GitHub</a> 上に<br/>公開されている</p>
</div>
<div><p>パッケージとして<br/>独立した<br/>バージョニング</p>
</div>
<div><img src="img/Versioning1.png"/>

</div>
<div><img src="img/Versioning2.png"/>

</div>
<div><img src="img/Versioning3.png"/>

</div>
<div><img src="img/Versioning4.png"/>

</div>
<div><p><notes>というように、パッケージの外枠についてカスタマイズが考慮されたものになっているが、
中身についてもカスタマイズが許容されるものになっている
というのも……</notes></p>
</div>
<div><p>今までのUnity<br/>謎マクロ<br/>謎プラグマが暗躍</p>
<p><notes>謎なブラックボックス部分が多くてカスタマイズしにくいという側面があった</notes></p>
</div>
<div><pre>#pragma surface surf Standard vertex:vert addshadow

void vert(inout appdata_full v, out Input data)
{
  UNITY_INITIALIZE_OUTPUT(Input, data);
  ...
}

void surf(Input IN, inout SurfaceOutputStandard o)
{
  ...
}</pre>

<p><notes>シェーダーコンパイラが見えない所で生成するものが多く、読み解くにも限界が</notes></p>
</div>
<div><p>普通のC言語風の実装<br/>ソースから解読可能<br/>改造も可能</p>
<p><notes>シェーダーライブラリも汎用性の高いものになっている</notes></p>
</div>
<div><p>まずはここから <a href="https://github.com/Unity-Technologies/ScriptableRenderPipeline/blob/master/com.unity.render-pipelines.high-definition/HDRP/Material/Lit/Lit.shader">HDRP/Material/Lit/Lit.shader
</a></p>
</div>
<div><p>#define<br/>#ifdef<br/>#include<br/>の塊</p>
</div>
<div><p>ホワイトボックス<br/>なので諦める<br/>ポイントは少ない</p>
</div>
<div><img style="width:100%;height:1px" src="img/Blank.png"/>

<img style="width:49%" src="img/CustomShader1.gif"/>
<img style="width:49%" src="img/CustomShader2.gif"/>

<img style="width:49%" src="img/CustomShader3.gif"/>
<img style="width:49%" src="img/CustomShader4.gif"/>

<img style="width:100%;height:1px" src="img/Blank.png"/>

</div>
<div><br/>

</div>
<div><p>HDRP<br/>導入検討の<br/>ポイント</p>
</div>
<div><p>で、もう<br/>完成してるの？<br/>使っていいの？</p>
<p><notes>残念ながら、まだプレビュー
Unity 2019 のどこかでプレビューを外したい</notes></p>
</div>
<div><ul>
<li>未実装部分がある</li>
<li>後方互換性が不確実</li>
</ul>
</div>
<div><ul>
<li>長期プロジェクトへの導入は慎重に</li>
<li>ワンオフものならアリかも</li>
</ul>
<p><notes>後方互換性がしっかりしていないので、長期間付き合っていくのはつらい
とは言え、いきなりクラッシュするような不安定さは無いので、短期間の用途で使うなら</notes></p>
</div>
<div><p>謝辞</p>
<ul>
<li><p>Statue models scanned by Geoffrey Marchal (CC-BY)</p>
<p><a href="https://sketchfab.com/geoffreymarchal">https://sketchfab.com/geoffreymarchal</a></p>
</li>
<li><p>Photogrammetric textures created by StruffelProductions (CC0)</p>
<p><a href="https://cc0textures.com">https://cc0textures.com</a></p>
</li>
</ul>
</div>
</body>
</html>
